<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>Money Web</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0; }
    header { display:flex; justify-content:space-between; padding:15px; background:#4CAF50; color:#fff; }
    .profile { font-weight:bold; }
    .balance { font-size:18px; }
    .container { padding:20px; text-align:center; }
    button { padding:10px 20px; margin:10px; border:none; border-radius:5px; cursor:pointer; }
    .btn-main { background:#4CAF50; color:#fff; }
    .btn-secondary { background:#2196F3; color:#fff; }
    .btn-disabled { background:#ccc; color:#666; cursor:not-allowed; }
    .ads { margin:15px 0; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ccc; padding:8px; }
    th { background:#eee; }
    /* Custom popup */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .modal-content { background:#fff; padding:20px; border-radius:8px; width:300px; text-align:center; }
    .modal-content h3 { margin-top:0; }
    .close-btn { margin-top:15px; padding:8px 16px; background:#4CAF50; color:#fff; border:none; border-radius:5px; cursor:pointer; }
  </style>
</head>
<body><header>
  <div class="profile" id="profileName">Guest</div>
  <div class="balance">Saldo: Rp<span id="saldo">0</span></div>
</header><div class="container" id="authSection">
  <h2>Login / Registrasi</h2>
  <div class="ads">[Banner Hiltoads Atas]</div>
  <input type="email" id="email" placeholder="Email"><br><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button onclick="login()" class="btn-main">Login</button>
  <button onclick="register()" class="btn-secondary">Register</button>
  <div class="ads">[Banner Hiltoads Bawah]</div>
</div><div class="container" id="mainSection" style="display:none;">
  <button id="monetagBtn" class="btn-main">Klik Iklan Monetag (Reward Rp10)</button><br>
  <button id="hiltoadsBtn" class="btn-secondary">Klik Iklan Hiltoads (Reward Rp10)</button><br>
  <button onclick="showWithdraw()" class="btn-main">Withdraw</button>
  <button onclick="openHelp()" class="btn-secondary">Help</button>  <!-- Withdraw form -->  <div id="withdrawForm" style="display:none; margin-top:20px;">
    <h3>Withdraw E-Wallet</h3>
    <select id="ewalletType">
      <option value="Dana">Dana</option>
      <option value="OVO">OVO</option>
      <option value="GoPay">GoPay</option>
      <option value="ShopeePay">ShopeePay</option>
    </select><br><br>
    <input id="ewalletNumber" placeholder="Nomor HP / Akun"><br><br>
    <input id="wdAmount" type="number" placeholder="Jumlah (min 30000)"><br><br>
    <button onclick="requestWithdraw()" class="btn-main">Ajukan WD</button>
  </div>  <!-- Riwayat WD -->  <div style="margin-top:30px;">
    <h3>Riwayat Withdraw</h3>
    <table id="historyTable">
      <thead>
        <tr><th>E-Wallet</th><th>Nomor</th><th>Jumlah</th><th>Status</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div><!-- Modal --><div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <p id="modalMsg"></p>
    <button class="close-btn" onclick="closeModal()">OK</button>
  </div>
</div><script>
const firebaseConfig = {
  apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
  authDomain: "penyimpanansaldo-280df.firebaseapp.com",
  databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "penyimpanansaldo-280df",
  storageBucket: "penyimpanansaldo-280df.firebasestorage.app",
  messagingSenderId: "659609775130",
  appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
  measurementId: "G-L4TW7E23H2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;

// Auto login persistence
firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);

auth.onAuthStateChanged(user => {
  if(user){
    currentUser = user;
    document.getElementById("authSection").style.display="none";
    document.getElementById("mainSection").style.display="block";
    document.getElementById("profileName").innerText = user.email;
    loadSaldo(user.uid);
    loadWithdrawHistory(user.uid);
  } else {
    currentUser = null;
    document.getElementById("authSection").style.display="block";
    document.getElementById("mainSection").style.display="none";
  }
});

function register(){
  let email=document.getElementById("email").value;
  let pass=document.getElementById("password").value;
  auth.createUserWithEmailAndPassword(email,pass)
    .then(()=>showModal("Sukses","Registrasi berhasil!"))
    .catch(err=>showModal("Error",err.message));
}

function login(){
  let email=document.getElementById("email").value;
  let pass=document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email,pass)
    .catch(err=>showModal("Error",err.message));
}

function loadSaldo(uid){
  db.ref("users/"+uid+"/saldo").on("value",snap=>{
    document.getElementById("saldo").innerText = snap.val()||0;
  });
}

// Monetag button
let monetagClicks = 0;
document.getElementById("monetagBtn").onclick=()=>{
  if(!currentUser) return;
  if(monetagClicks>=20){
    showModal("Info","Batas harian tercapai. Coba lagi besok 03.00");
    return;
  }
  monetagClicks++;
  addSaldo(10);
  disableBtn("monetagBtn",5);
};

// Hiltoads button
let hiltoadsCooldown=false;
document.getElementById("hiltoadsBtn").onclick=()=>{
  if(hiltoadsCooldown){
    showModal("Info","Tunggu cooldown 10 menit");
    return;
  }
  addSaldo(10);
  disableBtn("hiltoadsBtn",600);
  hiltoadsCooldown=true;
  setTimeout(()=>hiltoadsCooldown=false,600000);
};

function addSaldo(amount){
  const ref=db.ref("users/"+currentUser.uid+"/saldo");
  ref.transaction(saldo=> (saldo||0)+amount);
  showModal("Sukses","+Rp"+amount+" berhasil ditambahkan!");
}

function disableBtn(id,sec){
  const btn=document.getElementById(id);
  btn.disabled=true;
  btn.classList.add("btn-disabled");
  let old=btn.innerText;
  let time=sec;
  btn.innerText=old+" ("+time+")";
  let int=setInterval(()=>{
    time--; btn.innerText=old+" ("+time+")";
    if(time<=0){clearInterval(int);btn.disabled=false;btn.classList.remove("btn-disabled");btn.innerText=old;}
  },1000);
}

// Withdraw
function showWithdraw(){
  document.getElementById("withdrawForm").style.display="block";
}

function requestWithdraw(){
  let amount=parseInt(document.getElementById("wdAmount").value);
  let type=document.getElementById("ewalletType").value;
  let number=document.getElementById("ewalletNumber").value;
  if(!amount || amount<30000){showModal("Error","Minimal WD Rp30.000");return;}
  if(!number){showModal("Error","Nomor e-wallet wajib diisi");return;}
  db.ref("users/"+currentUser.uid+"/saldo").once("value").then(snap=>{
    let saldo=snap.val()||0;
    if(saldo<amount){showModal("Error","Saldo tidak cukup");return;}
    // kurangi saldo
    db.ref("users/"+currentUser.uid+"/saldo").set(saldo-amount);
    // simpan request
    let req=db.ref("withdrawRequests").push();
    req.set({uid:currentUser.uid,email:currentUser.email,type:type,number:number,amount:amount,status:"pending",createdAt:Date.now()});
    showModal("Sukses","WD diajukan, tunggu diproses admin");
  });
}

function loadWithdrawHistory(uid){
  db.ref("withdrawRequests").orderByChild("uid").equalTo(uid).on("value",snap=>{
    const tbody=document.querySelector("#historyTable tbody");
    tbody.innerHTML="";
    snap.forEach(child=>{
      let wd=child.val();
      let tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${wd.type}</td>
        <td>${wd.number}</td>
        <td>Rp${wd.amount}</td>
        <td style="color:${wd.status=="approved"?"green":wd.status=="rejected"?"red":"orange"};">${wd.status}</td>
      `;
      tbody.appendChild(tr);
    });
  });
}

function openHelp(){
  window.location.href="https://t.me/YourTelegramUsername";
}

// Modal
function showModal(title,msg){
  document.getElementById("modalTitle").innerText=title;
  document.getElementById("modalMsg").innerText=msg;
  document.getElementById("modal").style.display="flex";
}
function closeModal(){
  document.getElementById("modal").style.display="none";
}
</script></body>
</html>
