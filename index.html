<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Penghasil Uang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    :root {
      --bg: #f4f7fa;
      --text: #000;
      --card: #fff;
      --header: #2196F3;
      --btn-monetag: #4CAF50;
      --btn-hiltoads: #FF9800;
      --btn-help: #607D8B;
      --btn-wd: #9C27B0;
    }
    body.dark {
      --bg: #121212;
      --text: #f0f0f0;
      --card: #1e1e1e;
      --header: #333;
    }
    body {
      font-family: Arial, sans-serif; background: var(--bg); color: var(--text); margin:0; padding:0;
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding:15px; background: var(--header); color:white;
    }
    header img { width:40px; height:40px; border-radius:50%; }
    .saldo { font-size:16px; font-weight:bold; }
    main { padding:20px; }
    button {
      width:100%; padding:12px; margin:10px 0;
      border:none; border-radius:10px; font-size:16px; cursor:pointer;
    }
    .monetag { background: var(--btn-monetag); color:white; }
    .hiltoads { background: var(--btn-hiltoads); color:white; }
    .help { background: var(--btn-help); color:white; }
    .wd { background: var(--btn-wd); color:white; }
    .card { background: var(--card); padding:10px; border-radius:10px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .notif { background:#333; color:#fff; padding:10px; border-radius:8px; text-align:center; display:none; margin:10px; }
    .theme-toggle { cursor:pointer; font-size:20px; }
  </style>
</head>
<body>

  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <img id="profilePic" src="https://via.placeholder.com/40">
      <span id="username">User</span>
    </div>
    <div style="display:flex;align-items:center;gap:15px;">
      <div class="saldo">Rp<span id="saldo">0</span></div>
      <div class="theme-toggle" id="themeToggle">üåô</div>
    </div>
  </header>

  <div class="notif" id="notif"></div>

  <main>
    <button class="monetag" id="monetagBtn">Klik Iklan Monetag (Reward Rp10)</button>
    <button class="hiltoads" id="hiltoadsBtn">Tonton Hiltoads (Reward Rp10)</button>
    <button class="help" onclick="window.open('https://t.me/username','_blank')">Help (Telegram)</button>
    <button class="wd" onclick="withdraw()">Withdraw</button>

    <h3>Riwayat WD</h3>
    <div id="wdHistory"></div>
  </main>

  <script>
    // üî• Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
      authDomain: "penyimpanansaldo-280df.firebaseapp.com",
      databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "penyimpanansaldo-280df",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const fs = firebase.firestore();

    // ‚úÖ Notif helper
    function notif(msg){
      let n=document.getElementById("notif");
      n.innerText=msg;
      n.style.display="block";
      setTimeout(()=>{n.style.display="none"},3000);
    }

    let currentUser;
    let monetagCooldown = 0;
    let hiltoadsCooldown = 0;

    auth.onAuthStateChanged(user=>{
      if(user){
        currentUser=user;
        document.getElementById("username").innerText=user.email;
        if(user.photoURL) document.getElementById("profilePic").src=user.photoURL;

        // listen saldo
        db.ref("users/"+user.uid+"/saldo").on("value",snap=>{
          document.getElementById("saldo").innerText=snap.val()||0;
        });

        // listen WD history
        fs.collection("withdrawRequests")
          .where("email","==",user.email)
          .orderBy("created","desc")
          .onSnapshot(snaps=>{
            let list="";
            snaps.forEach(doc=>{
              let wd=doc.data();
              let status = wd.status==="approved"?"‚úÖ Sukses":
                           wd.status==="rejected"?"‚ùå Ditolak":"‚è≥ Pending";
              list+=`<div class="card">
                <b>${wd.type} - ${wd.number}</b><br>
                Rp${wd.amount}<br>
                <span>${status}</span>
              </div>`;
            });
            document.getElementById("wdHistory").innerHTML=list;
          });
      } else {
        window.location.href="login.html"; // ganti sesuai file login
      }
    });

    // ‚úÖ Monetag
    document.getElementById("monetagBtn").onclick=()=>{
      let ref=db.ref("users/"+currentUser.uid);
      ref.once("value").then(snap=>{
        let data=snap.val()||{};
        let now=Date.now();
        let last=data.lastMonetag||0;
        let count=data.dailyMonetag||0;

        // reset harian jam 03:00
        let today=new Date();
        today.setHours(3,0,0,0);
        if(!data.resetDate||data.resetDate<today.getTime()){
          count=0;
          ref.update({resetDate:today.getTime(),dailyMonetag:0});
        }

        if(now-last<5000){
          monetagCooldown = Math.ceil((5000-(now-last))/1000);
          notif("Cooldown Monetag belum selesai!");
          return;
        }
        if(count>=20){ notif("Limit harian 20x tercapai"); return; }

        ref.child("saldo").transaction(saldo=>(saldo||0)+10);
        ref.update({lastMonetag:now,dailyMonetag:count+1});
        notif("Reward +Rp10 dari Monetag");
        monetagCooldown=5;
      });
    };

    // ‚úÖ Hiltoads
    document.getElementById("hiltoadsBtn").onclick=()=>{
      let ref=db.ref("users/"+currentUser.uid);
      ref.once("value").then(snap=>{
        let data=snap.val()||{};
        let now=Date.now();
        let last=data.lastHiltoads||0;

        if(now-last<600000){
          hiltoadsCooldown = Math.ceil((600000-(now-last))/1000);
          notif("Cooldown Hiltoads belum selesai!");
          return;
        }

        ref.child("saldo").transaction(saldo=>(saldo||0)+10);
        ref.update({lastHiltoads:now});
        notif("Reward +Rp10 dari Hiltoads");
        hiltoadsCooldown=600;
      });
    };

    // ‚úÖ Countdown updater
    setInterval(()=>{
      if(monetagCooldown>0){
        document.getElementById("monetagBtn").innerText=`Tunggu ${monetagCooldown}s`;
        document.getElementById("monetagBtn").disabled=true;
        monetagCooldown--;
      } else {
        document.getElementById("monetagBtn").innerText="Klik Iklan Monetag (Reward Rp10)";
        document.getElementById("monetagBtn").disabled=false;
      }
      if(hiltoadsCooldown>0){
        document.getElementById("hiltoadsBtn").innerText=`Tunggu ${hiltoadsCooldown}s`;
        document.getElementById("hiltoadsBtn").disabled=true;
        hiltoadsCooldown--;
      } else {
        document.getElementById("hiltoadsBtn").innerText="Tonton Hiltoads (Reward Rp10)";
        document.getElementById("hiltoadsBtn").disabled=false;
      }
    },1000);

    // ‚úÖ Withdraw
    function withdraw(){
      let amount=prompt("Masukkan jumlah WD (min Rp30000):");
      amount=parseInt(amount);
      if(isNaN(amount)||amount<30000){ notif("Minimal WD Rp30000"); return; }
      let type=prompt("Masukkan jenis E-Wallet (OVO/DANA/Gopay):");
      let number=prompt("Masukkan nomor E-Wallet:");

      let ref=db.ref("users/"+currentUser.uid+"/saldo");
      ref.once("value").then(snap=>{
        let saldo=snap.val()||0;
        if(saldo<amount){ notif("Saldo tidak cukup!"); return; }

        ref.set(saldo-amount);
        fs.collection("withdrawRequests").add({
          email:currentUser.email,
          type:type, number:number,
          amount:amount,
          status:"pending",
          created:firebase.firestore.FieldValue.serverTimestamp()
        });
        notif("Permintaan WD terkirim!");
      });
    }

    // ‚úÖ Tema toggle
    const themeToggle=document.getElementById("themeToggle");
    if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark"); themeToggle.innerText="‚òÄÔ∏è";}
    themeToggle.onclick=()=>{
      document.body.classList.toggle("dark");
      if(document.body.classList.contains("dark")){
        themeToggle.innerText="‚òÄÔ∏è"; localStorage.setItem("theme","dark");
      } else {
        themeToggle.innerText="üåô"; localStorage.setItem("theme","light");
      }
    };
  </script>

</body>
</html>
