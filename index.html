<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Penghasil Uang</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
    .container { max-width: 500px; margin: auto; padding: 20px; }

    .card {
      background: white; padding: 20px; border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    h2 { text-align: center; margin-bottom: 20px; }

    input, button {
      width: 100%; padding: 10px; margin: 8px 0;
      border-radius: 8px; border: 1px solid #ccc;
    }
    button {
      background: #2196F3; color: white; border: none;
      cursor: pointer; font-weight: bold;
    }
    button:disabled { background: #ccc; cursor: not-allowed; }

    .top-bar {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 20px;
    }
    .profile { display: flex; align-items: center; gap: 10px; }
    .profile img { width: 40px; height: 40px; border-radius: 50%; background: #ddd; }

    .actions button { margin-top: 10px; }

    /* Modal Notifikasi */
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.6);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 10px;
      width: 80%; max-width: 350px; text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3); animation: fadeIn 0.3s ease;
    }
    .modal-content.success { border-top: 6px solid #4CAF50; }
    .modal-content.error { border-top: 6px solid #f44336; }
    .modal-content h3 { margin: 0 0 10px; }
    .modal-content button {
      padding: 10px 20px; background: #2196F3; color: white;
      border: none; border-radius: 5px; cursor: pointer;
    }

    /* Loading Spinner */
    #loading {
      display: none; position: fixed; z-index: 2000;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); display: flex;
      justify-content: center; align-items: center;
    }
    .spinner {
      width: 60px; height: 60px;
      border: 6px solid #ccc; border-top: 6px solid #2196F3;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg);} }
    @keyframes fadeIn { from {opacity: 0; transform: translateY(-20px);} to {opacity: 1; transform: translateY(0);} }
  </style>
</head>
<body>
  <div class="container" id="authPage">
    <div class="card">
      <h2>Login / Registrasi</h2>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button onclick="register()">Registrasi</button>
      <button onclick="login()">Login</button>
    </div>
  </div>

  <div class="container" id="mainPage" style="display:none;">
    <div class="top-bar">
      <div class="profile">
        <img id="profilePic" src="">
        <span id="userName"></span>
      </div>
      <div><b>Saldo: Rp <span id="saldo">0</span></b></div>
    </div>

    <div class="card actions">
      <button id="iklanBtn" onclick="klikIklan()">Klik Iklan Monetag (+Rp10)</button>
      <button id="hiltoadsBtn" onclick="lihatIklanHiltoads()">Lihat Iklan Hiltoads (+Rp10)</button>
    </div>

    <div class="card">
      <button onclick="help()">Help</button>
      <button onclick="withdraw()">Withdraw</button>
    </div>
  </div>

  <!-- Modal Notifikasi -->
  <div id="notifModal" class="modal">
    <div id="notifContent" class="modal-content">
      <h3 id="notifTitle"></h3>
      <p id="notifMessage"></p>
      <button onclick="closeNotification()">Oke</button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div id="loading"><div class="spinner"></div></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
      authDomain: "penyimpanansaldo-280df.firebaseapp.com",
      databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "penyimpanansaldo-280df",
      storageBucket: "penyimpanansaldo-280df.firebasestorage.app",
      messagingSenderId: "659609775130",
      appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
      measurementId: "G-L4TW7E23H2"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Show & Hide Loading
    function showLoading(){ document.getElementById("loading").style.display="flex"; }
    function hideLoading(){ document.getElementById("loading").style.display="none"; }

    // Modal Notification
    function showNotification(message, type="success") {
      hideLoading();
      const modal = document.getElementById("notifModal");
      const content = document.getElementById("notifContent");
      const title = document.getElementById("notifTitle");
      const msg = document.getElementById("notifMessage");
      content.className = "modal-content " + type;
      title.innerText = (type === "success") ? "Berhasil ✅" : "Gagal ❌";
      msg.innerText = message;
      modal.style.display = "flex";
    }
    function closeNotification() {
      document.getElementById("notifModal").style.display = "none";
    }

    // Auto Login
    auth.onAuthStateChanged(user => {
      if(user) {
        document.getElementById("authPage").style.display = "none";
        document.getElementById("mainPage").style.display = "block";
        loadUser(user);
      } else {
        document.getElementById("authPage").style.display = "block";
        document.getElementById("mainPage").style.display = "none";
      }
    });

    function register(){
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      showLoading();
      auth.createUserWithEmailAndPassword(email, pass)
        .then(res=>{
          db.ref("users/"+res.user.uid).set({
            email: email,
            saldo: 0,
            lastIklan: 0,
            iklanCount: 0,
            lastHiltoads: 0
          });
          showNotification("Registrasi berhasil!", "success");
        }).catch(err=>showNotification(err.message, "error"));
    }

    function login(){
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      showLoading();
      auth.signInWithEmailAndPassword(email, pass)
        .then(()=>showNotification("Login berhasil!", "success"))
        .catch(err=>showNotification(err.message, "error"));
    }

    function loadUser(user){
      db.ref("users/"+user.uid).on("value", snap=>{
        if(snap.exists()){
          const data = snap.val();
          document.getElementById("saldo").innerText = data.saldo || 0;
          document.getElementById("userName").innerText = data.email.split("@")[0];
          document.getElementById("profilePic").src = "https://ui-avatars.com/api/?name="+data.email[0].toUpperCase();
        }
      });
    }

    // Klik Iklan Monetag
    function klikIklan(){
      const user = auth.currentUser;
      if(!user) return;
      showLoading();
      const ref = db.ref("users/"+user.uid);
      ref.once("value").then(snap=>{
        let data = snap.val();
        let now = Date.now();
        let today = new Date().toDateString();
        let lastDay = data.lastDay || "";
        if(lastDay !== today){ data.iklanCount = 0; data.lastDay = today; }
        if(data.iklanCount >= 20){
          showNotification("Batas harian tercapai! Tunggu jam 03.00", "error");
          return;
        }
        if(now - (data.lastIklan || 0) < 5000){
          showNotification("Tunggu 5 detik sebelum klik lagi", "error");
          return;
        }
        data.saldo += 10;
        data.lastIklan = now;
        data.iklanCount++;
        ref.update(data);
        showNotification("Berhasil dapat Rp10!", "success");
      });
    }

    // Iklan Hiltoads
    function lihatIklanHiltoads(){
      const user = auth.currentUser;
      if(!user) return;
      showLoading();
      const ref = db.ref("users/"+user.uid);
      ref.once("value").then(snap=>{
        let data = snap.val();
        let now = Date.now();
        if(now - (data.lastHiltoads || 0) < 600000){
          showNotification("Tunggu 10 menit sebelum lihat iklan lagi", "error");
          return;
        }
        data.saldo += 10;
        data.lastHiltoads = now;
        ref.update(data);
        showNotification("Berhasil lihat iklan Hiltoads +Rp10", "success");
      });
    }

    // Help
    function help(){
      showNotification("Hubungi admin di Telegram: @usernameAnda", "success");
    }

    // Withdraw
    function withdraw(){
      const user = auth.currentUser;
      if(!user) return;
      showLoading();
      db.ref("users/"+user.uid).once("value").then(snap=>{
        let data = snap.val();
        if(data.saldo < 30000){
          showNotification("Saldo kamu belum cukup. Minimal Rp30.000", "error");
          return;
        }
        db.ref("users/"+user.uid).update({saldo: data.saldo - 30000});
        showNotification("WD berhasil diproses ke E-Wallet", "success");
      });
    }
  </script>
</body>
</html>
