<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NusaTask ‚Äî All in One</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- ====== IKLAN / SDK ====== -->
  <!-- Telegram WebApp (untuk Adexium & RichAds di Telegram) -->
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>

  <!-- ADEXIUM widget (manual dibuat saat tombol diklik agar tidak auto-popup) -->
  <script src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>

  <!-- RICHADS (TelegramAdsController) -->
  <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>

  <!-- MONETAG SDK -->
  <script src="//libtl.com/sdk.js" data-zone="9779635" data-sdk="show_9779635"></script>

  <style>
    :root{
      --bg:#0b1420; --card:#121c2b; --muted:#8293a8;
      --text:#e8f0ff; --brand:#1976ff; --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444;
      --btn:#1f2b3d; --btnText:#e8f0ff; --btnCool:#2b374b;
      --chip:#0f172a; --chipText:#cbd5e1;
    }
    .light{
      --bg:#f7fafc; --card:#ffffff; --muted:#475569;
      --text:#0f172a; --brand:#0ea5e9; --ok:#16a34a; --warn:#d97706; --danger:#ef4444;
      --btn:#e2e8f0; --btnText:#0f172a; --btnCool:#cbd5e1;
      --chip:#e2e8f0; --chipText:#0f172a;
    }
    *{box-sizing:border-box} body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      background:var(--bg); color:var(--text);
    }
    .container{max-width:920px;margin:0 auto;padding:18px}
    .row{display:flex;gap:14px;flex-wrap:wrap}
    .card{background:var(--card); border-radius:16px; padding:16px; box-shadow:0 6px 28px rgba(0,0,0,.25)}
    .title{font-weight:800; font-size:22px; margin:0}
    .muted{color:var(--muted); font-size:13px}
    .badge{background:var(--chip); color:var(--chipText); font-weight:600; padding:4px 10px; border-radius:999px}
    .btn{appearance:none;border:0;border-radius:14px;padding:14px 16px;background:var(--btn);color:var(--btnText);font-weight:700;cursor:pointer;transition:.2s; width:100%}
    .btn:hover{opacity:.92; transform:translateY(-1px)}
    .btnPrimary{background:var(--brand); color:#fff}
    .btnOk{background:var(--ok); color:#fff}
    .btnWarn{background:var(--warn); color:#0b1420}
    .btnDanger{background:var(--danger); color:#fff}
    .btnCool{background:var(--btnCool); color:#9fb0c6; cursor:not-allowed}
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:14px}
    .grid3{display:grid; grid-template-columns: repeat(3,1fr); gap:14px}
    .field{display:flex;flex-direction:column;gap:8px}
    .input, select{
      width:100%; padding:14px 12px; border-radius:12px; border:1px solid transparent; outline:none;
      background:var(--btn); color:var(--btnText); font-weight:600;
    }
    .pill{padding:10px 12px;border-radius:12px;background:var(--chip);color:var(--chipText);font-weight:700}
    .topbar{display:flex;align-items:center;gap:12px; justify-content:space-between}
    .user{display:flex; align-items:center; gap:12px}
    .avatar{width:46px;height:46px;border-radius:999px;background:#334155;display:grid;place-items:center;font-weight:800}
    .hidden{display:none !important}
    hr{border:0;border-top:1px solid rgba(255,255,255,.08)}
    .label{font-weight:800;font-size:14px}
    .right{margin-left:auto}
    .link{color:#fff;text-decoration:none}
    .kpi{display:flex; gap:10px; align-items:center}
    .kpi span{font-size:12px}
    .footerlinks{display:flex; gap:14px; flex-wrap:wrap}
    .chipSmall{font-size:12px; padding:6px 10px}
    .list{display:flex;flex-direction:column;gap:10px}
    .item{padding:12px;border-radius:12px;background:var(--btn);display:flex;justify-content:space-between;align-items:center}
    .status{font-weight:800}
    .s-success{color:#22c55e}.s-pending{color:#fbbf24}.s-failed{color:#ef4444}
    .center{text-align:center}
  </style>
</head>
<body>

  <div class="container">

    <!-- =================== AUTH =================== -->
    <section id="auth" class="card">
      <h1 class="title">üîê Masuk / Daftar</h1>
      <p class="muted">Gunakan email & password. Jika belum punya akun, pilih tab Register.</p>
      <div class="row">
        <button id="tabLogin" class="btn btnPrimary" style="max-width:160px">Login</button>
        <button id="tabRegister" class="btn" style="max-width:160px">Register</button>
        <div class="right muted">Iklan Hiltoads A ¬∑ B ¬∑ C ¬∑ D (opsional)</div>
      </div>
      <div id="loginForm" class="row" style="margin-top:12px">
        <div class="field" style="flex:1 1 280px; min-width:260px">
          <label class="label">Email</label>
          <input id="loginEmail" class="input" type="email" placeholder="email@domain.com">
        </div>
        <div class="field" style="flex:1 1 240px; min-width:220px">
          <label class="label">Password</label>
          <input id="loginPass" class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="field" style="width:160px">
          <label class="label">&nbsp;</label>
          <button id="btnLogin" class="btn btnPrimary">Login</button>
        </div>
      </div>
      <div id="registerForm" class="row hidden" style="margin-top:12px">
        <div class="field" style="flex:1 1 280px; min-width:260px">
          <label class="label">Email</label>
          <input id="regEmail" class="input" type="email" placeholder="email@domain.com">
        </div>
        <div class="field" style="flex:1 1 240px; min-width:220px">
          <label class="label">Password</label>
          <input id="regPass" class="input" type="password" placeholder="min 6 karakter">
        </div>
        <div class="field" style="width:160px">
          <label class="label">&nbsp;</label>
          <button id="btnRegister" class="btn btnOk">Daftar</button>
        </div>
      </div>
      <p id="authMsg" class="muted" style="margin-top:10px"></p>
    </section>

    <!-- =================== APP =================== -->
    <section id="app" class="hidden">

      <!-- HEADER -->
      <div class="card">
        <div class="topbar">
          <div class="user">
            <div class="avatar" id="avatar">NT</div>
            <div>
              <div id="userEmail" style="font-weight:800"></div>
              <div class="muted">Aktif</div>
            </div>
          </div>
          <div class="kpi">
            <span class="muted">Saldo</span>
            <div id="saldo" class="pill">Rp 0</div>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <div class="pill">Menghasilkan: <b id="hit1">0</b>/20</div>
          <div class="pill">Xstra 1: <b id="hit2">0</b>/20</div>
          <div class="pill">Xstra 2: <b id="hit4">0</b>/20</div>
          <div class="pill">Xstra 3: <b id="hit6">0</b>/20</div>
          <div class="pill">Monetag: <b id="hit3">0</b>/20</div>
          <div class="pill">Adexium: <b id="hit5">0</b>/20</div>
        </div>
        <div class="row" style="margin-top:12px">
          <button id="btnTheme" class="btn" style="min-width:140px">üåó Tema</button>
          <a class="btn" style="min-width:140px;text-align:center;text-decoration:none" href="https://t.me/NusaTaskHelp" target="_blank">Help</a>
          <button id="btnLogout" class="btn btnDanger right" style="min-width:160px">Logout</button>
        </div>
        <div class="footerlinks" style="margin-top:12px">
          <a class="btn" style="max-width:200px;text-decoration:none;background:#000" href="https://www.youtube.com/@NUSATASKPROJECTS" target="_blank">YouTube</a>
          <a class="btn" style="max-width:200px;text-decoration:none;background:#e11d48" href="https://www.instagram.com/nusataskproject?igsh=MTh5Ync0bjhqeGxtdg==" target="_blank">Instagram</a>
        </div>
      </div>

      <!-- TOMBOL IKLAN -->
      <div class="card">
        <h2 class="title">Menghasilkan</h2>
        <p class="muted">Setiap tombol punya cooldown <b>3 menit</b> & limit harian <b>20x</b> masing-masing. Countdown akan tampil di tombol.</p>

        <!-- BARIS 1 -->
        <div class="grid2" style="margin-top:8px">
          <button id="btnRich" class="btn btnPrimary adbtn" data-key="rich" data-label="Menghasilkan (RichAds)">üöÄ Menghasilkan <small>(RichAds)</small></button>
          <button id="btnX1" class="btn btnWarn adbtn" data-key="x1" data-label="Xstra Bonus 1">‚è≥ Xstra Bonus 1</button>
        </div>
        <!-- BARIS 2 -->
        <div class="grid2" style="margin-top:8px">
          <button id="btnMonetag" class="btn btnOk adbtn" data-key="monetag" data-label="Menghasilkan (Monetag)">üöÄ Menghasilkan <small>(Monetag)</small></button>
          <button id="btnX2" class="btn btnWarn adbtn" data-key="x2" data-label="Xstra Bonus 2">‚è≥ Xstra Bonus 2</button>
        </div>
        <!-- BARIS 3 -->
        <div class="grid2" style="margin-top:8px">
          <button id="btnAdex" class="btn btnPrimary adbtn" data-key="adex" data-label="Menghasilkan (Adexium)">üöÄ Menghasilkan <small>(Adexium)</small></button>
          <button id="btnX3" class="btn btnWarn adbtn" data-key="x3" data-label="Xstra Bonus 3">‚è≥ Xstra Bonus 3</button>
        </div>

        <p id="earnMsg" class="muted" style="margin-top:10px"></p>
      </div>

      <!-- WITHDRAW -->
      <div class="card">
        <div class="topbar">
          <h2 class="title">Withdraw</h2>
          <button id="btnRiwayat" class="btn">üìú Riwayat</button>
        </div>
        <div class="grid3" style="margin-top:12px">
          <div class="field">
            <label class="label">E-Wallet</label>
            <select id="walletType">
              <option value="Dana">Dana</option>
              <option value="OVO">OVO</option>
              <option value="GoPay">GoPay</option>
              <option value="ShopeePay">ShopeePay</option>
            </select>
          </div>
          <div class="field">
            <label class="label">Nomor e-wallet</label>
            <input id="walletNumber" class="input" inputmode="numeric" placeholder="08xxxxxxxxxx">
          </div>
          <div class="field">
            <label class="label">Jumlah</label>
            <input id="wdAmount" class="input" type="number" min="30000" step="1000" value="30000">
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <button id="btnWithdraw" class="btn btnOk">Ajukan WD (Min Rp30.000)</button>
        </div>
        <p class="muted" style="margin-top:8px">Notifikasi WD dikirim ke Telegram admin. Status bisa dilihat di Riwayat WD.</p>
        <p id="wdMsg" class="muted"></p>
      </div>

      <!-- RIWAYAT WD -->
      <div id="riwayatCard" class="card hidden">
        <div class="topbar">
          <h2 class="title">Riwayat Withdraw</h2>
          <button id="btnCloseRw" class="btn">‚¨ÖÔ∏è Kembali</button>
        </div>
        <p class="muted">Riwayat ter-update otomatis (realtime).</p>
        <div id="rwList" class="list"></div>
      </div>

    </section>
  </div>

  <!-- =================== SCRIPTS =================== -->
  <script type="module">
    /* ================= FIREBASE ================= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, serverTimestamp, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // === TODO: ISI KONFIGMU (kamu bilang sudah punya; tinggal tempel di sini) ===
    const firebaseConfig = {
      apiKey: "AIzaSyCfFmaHbml299cum515tIJt5NpukpTmhoM",
      authDomain: "penyimpanansaldo-280df.firebaseapp.com",
      databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "penyimpanansaldo-280df",
      storageBucket: "penyimpanansaldo-280df.appspot.com",
      messagingSenderId: "659609775130",
      appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
      measurementId: "G-L4TW7E23H2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    /* =============== KONSTAN / UTIL =============== */
    const TELEGRAM_BOT_TOKEN = "8236562243:AAFIyLCk2fu9-4GxxYSuIoSKw9DEiv1DVko";
    const TELEGRAM_CHAT_ID   = "8322802091";

    const $ = (id)=>document.getElementById(id);
    const show = (el)=>el.classList.remove("hidden");
    const hide = (el)=>el.classList.add("hidden");

    const formatRupiah = (n)=>"Rp "+(n||0).toLocaleString("id-ID");
    const todayKey = ()=> new Date().toISOString().slice(0,10); // YYYY-MM-DD

    const EARN_VALUE = 30000;              // nilai saldo per iklan berhasil
    const COOLDOWN_MS = 3*60*1000;         // 3 menit
    const MAX_PER_DAY = 20;                // limit harian per tombol
    const AD_KEYS = ["rich","x1","monetag","x2","adex","x3"]; // 6 tombol

    /* ======== STATE PER USER (localStorage) ======== */
    function stateKey(email){ return `nt_state_${email}` }
    function readState(email){
      const raw = localStorage.getItem(stateKey(email));
      let st = raw? JSON.parse(raw) : { d: todayKey(), hits:{}, last:{} };
      // reset jika hari berganti
      if(st.d !== todayKey()){ st = { d: todayKey(), hits:{}, last:{} }; }
      // pastikan semua kunci ada
      AD_KEYS.forEach(k=>{ if(typeof st.hits[k] !== "number") st.hits[k]=0; if(!st.last[k]) st.last[k]=0; });
      return st;
    }
    function writeState(email, st){ localStorage.setItem(stateKey(email), JSON.stringify(st)); }

    /* =============== UI REF =============== */
    const authSec = $("auth");
    const appSec  = $("app");
    const userEmailEl = $("userEmail");
    const saldoEl = $("saldo");
    const avatarEl = $("avatar");

    const hitEls = {
      rich:$("hit1"), x1:$("hit2"),
      monetag:$("hit3"), x2:$("hit4"),
      adex:$("hit5"), x3:$("hit6"),
    };

    /* =============== AUTH HANDLERS =============== */
    $("tabLogin").onclick = ()=>{ $("tabLogin").classList.add("btnPrimary"); $("tabRegister").classList.remove("btnPrimary"); hide($("registerForm")); show($("loginForm")); };
    $("tabRegister").onclick = ()=>{ $("tabRegister").classList.add("btnPrimary"); $("tabLogin").classList.remove("btnPrimary"); hide($("loginForm")); show($("registerForm")); };

    $("btnLogin").onclick = async ()=>{
      $("authMsg").textContent = "Memproses...";
      try{
        await signInWithEmailAndPassword(auth, $("loginEmail").value.trim(), $("loginPass").value.trim());
        $("authMsg").textContent = "";
      }catch(e){ $("authMsg").textContent = e.message; }
    };
    $("btnRegister").onclick = async ()=>{
      $("authMsg").textContent = "Mendaftarkan...";
      try{
        await createUserWithEmailAndPassword(auth, $("regEmail").value.trim(), $("regPass").value.trim());
        $("authMsg").textContent = "";
      }catch(e){ $("authMsg").textContent = e.message; }
    };
    $("btnLogout").onclick = ()=>signOut(auth);

    onAuthStateChanged(auth, async (user)=>{
      if(user){
        hide(authSec); show(appSec);
        userEmailEl.textContent = user.email;
        avatarEl.textContent = (user.email||"NT").slice(0,2).toUpperCase();

        // pastikan user doc ada
        const uref = doc(db,"users", user.uid);
        const usnap = await getDoc(uref);
        if(!usnap.exists()){
          await setDoc(uref, { uid:user.uid, email:user.email, balance:0, createdAt: serverTimestamp() });
        }
        // tampilkan saldo
        const uref2 = doc(db,"users", user.uid);
        const usnap2 = await getDoc(uref2);
        saldoEl.textContent = formatRupiah(usnap2.data().balance||0);

        // sync counters UI
        const st = readState(user.email);
        Object.entries(hitEls).forEach(([k,el])=> el.textContent = st.hits[k]||0 );

        // aktifkan ad buttons
        initAdButtons(user);

        // riwayat WD listener saat panel dibuka (dipicu oleh tombol Riwayat)
      }else{
        show(authSec); hide(appSec);
      }
    });

    /* =============== THEME =============== */
    const THEME_KEY="nt_theme";
    function applyTheme(){ document.documentElement.className = (localStorage.getItem(THEME_KEY)||"dark")==="light"?"light":""; }
    applyTheme();
    $("btnTheme").onclick = ()=>{
      const cur = localStorage.getItem(THEME_KEY)==="light"?"dark":"light";
      localStorage.setItem(THEME_KEY, cur);
      applyTheme();
    };

    /* =============== IKLAN HANDLERS =============== */

    // ‚Äî RichAds ‚Äî
    function showRichAds(){
      try{
        if(window.TelegramAdsController && typeof window.TelegramAdsController.showInterstitial==="function"){
          return window.TelegramAdsController.showInterstitial();
        }
        // fallback: beberapa integrasi cukup initialize -> kita resolve manual
        return Promise.resolve();
      }catch(e){ return Promise.reject(e); }
    }
    // pastikan controller sudah di-init
    window.TelegramAdsController = new TelegramAdsController();
    window.TelegramAdsController.initialize({ pubId:"984631", appId:"3504" });

    // ‚Äî Monetag ‚Äî (SDK inject di <head>)
    function showMonetag(){
      try{
        return window.show_9779635();
      }catch(e){ return Promise.reject(e); }
    }

    // ‚Äî Adexium ‚Äî
    function showAdexium(){
      return new Promise((resolve,reject)=>{
        try{
          const w = new AdexiumWidget({ wid: "b7f8386d-0a18-43d6-b658-27055787953f", adFormat:"interstitial" });
          // show via autoMode (akan render dan tampil sendiri)
          w.autoMode();
          // Beri sedikit waktu; resolve setelah 4 detik (umumnya interstitial muncul)
          setTimeout(()=>resolve(), 4000);
        }catch(e){ reject(e); }
      });
    }

    // util umum: update UI tombol saat cooldown berjalan
    function startCooldown(btn, untilTs){
      btn.disabled = true;
      btn.classList.add("btnCool");
      const baseText = btn.dataset.label || btn.textContent;
      const tick = ()=>{
        const remain = untilTs - Date.now();
        if(remain<=0){
          btn.disabled = false;
          btn.classList.remove("btnCool");
          btn.textContent = baseText;
          return;
        }
        const m = Math.floor(remain/60000);
        const s = Math.floor((remain%60000)/1000);
        btn.textContent = `${baseText} ‚Ä¢ ${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
        btn.__cdTimer = setTimeout(tick, 1000);
      };
      tick();
    }

    function initAdButtons(user){
      const st = readState(user.email);

      // tombol -> fungsi penayang
      const map = {
        rich:   { el:$("btnRich"),   fn:showRichAds },
        x1:     { el:$("btnX1"),     fn:showRichAds },
        monetag:{ el:$("btnMonetag"),fn:showMonetag },
        x2:     { el:$("btnX2"),     fn:showMonetag },
        adex:   { el:$("btnAdex"),   fn:showAdexium },
        x3:     { el:$("btnX3"),     fn:showAdexium },
      };

      // apply cooldown existing
      AD_KEYS.forEach(k=>{
        const el = map[k].el;
        el.dataset.label = el.dataset.label || el.textContent;
        if(Date.now() - (st.last[k]||0) < COOLDOWN_MS){
          const until = (st.last[k]||0)+COOLDOWN_MS;
          startCooldown(el, until);
        }
        el.onclick = async ()=>{
          // limit harian
          const cur = readState(user.email);
          if(cur.hits[k] >= MAX_PER_DAY){
            $("earnMsg").textContent = `${el.dataset.label} sudah mencapai batas harian ${MAX_PER_DAY}x.`;
            return;
          }
          // cooldown
          const diff = Date.now()- (cur.last[k]||0);
          if(diff < COOLDOWN_MS){
            $("earnMsg").textContent = `Tombol sedang cooldown. Tunggu ${(Math.ceil((COOLDOWN_MS-diff)/1000))} detik lagi.`;
            return;
          }

          $("earnMsg").textContent = `Menayangkan iklan: ${el.dataset.label} ...`;
          try{
            await map[k].fn();
            // reward (setelah iklan ditonton/ditampilkan)
            await addBalance(user.uid, EARN_VALUE);
            saldoEl.textContent = formatRupiah((parseInt(saldoEl.textContent.replace(/[^\d]/g,""))||0) + EARN_VALUE);

            const ns = readState(user.email);
            ns.hits[k] = (ns.hits[k]||0)+1; ns.last[k]=Date.now();
            writeState(user.email, ns);
            hitEls[k].textContent = ns.hits[k];

            $("earnMsg").textContent = `+${formatRupiah(EARN_VALUE)} dari ${el.dataset.label}.`;
            startCooldown(el, ns.last[k] + COOLDOWN_MS);
          }catch(err){
            console.error(err);
            $("earnMsg").textContent = `Gagal menayangkan iklan (${el.dataset.label}). Coba lagi.`;
          }
        };
      });
    }

    async function addBalance(uid, add){
      const uref = doc(db,"users",uid);
      const snap = await getDoc(uref);
      const cur = (snap.exists()? snap.data().balance : 0) || 0;
      await updateDoc(uref,{ balance: cur + add });
    }

    /* =============== WITHDRAW =============== */
    $("btnWithdraw").onclick = async ()=>{
      const user = auth.currentUser; if(!user){ return; }
      const amount = parseInt($("wdAmount").value,10)||0;
      if(amount < 30000){ $("wdMsg").textContent = "Minimal WD Rp30.000"; return; }

      const walletType = $("walletType").value;
      const walletNumber = $("walletNumber").value.trim();
      if(walletNumber.length<6){ $("wdMsg").textContent = "Nomor e-wallet tidak valid"; return; }

      $("wdMsg").textContent = "Mengirim pengajuan WD...";
      try{
        await addDoc(collection(db,"withdrawals"), {
          uid: user.uid, email: user.email,
          amount, walletType, walletNumber,
          status:"pending", createdAt: serverTimestamp()
        });

        // kirim notifikasi Telegram
        const text =
`üßæ *WD Baru*
Email: ${user.email}
Jumlah: Rp ${amount.toLocaleString("id-ID")}
E-Wallet: ${walletType}
Nomor: ${walletNumber}
Status: pending`;
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text, parse_mode:"Markdown" })
        });

        $("wdMsg").textContent = "WD terkirim. Cek status di Riwayat.";
      }catch(e){
        console.error(e);
        $("wdMsg").textContent = "Gagal mengirim WD. Coba lagi.";
      }
    };

    // RIWAYAT WD
    $("btnRiwayat").onclick = ()=>{ show($("riwayatCard")); attachRiwayat(); };
    $("btnCloseRw").onclick = ()=> hide($("riwayatCard"));

    let unsubRw = null;
    function attachRiwayat(){
      if(unsubRw) return; // sudah aktif
      const user = auth.currentUser; if(!user) return;
      const q = query(collection(db,"withdrawals"),
                      where("uid","==",user.uid),
                      orderBy("createdAt","desc"));
      unsubRw = onSnapshot(q, snap=>{
        const list = $("rwList"); list.innerHTML = "";
        if(snap.empty){ list.innerHTML = `<div class="muted">Belum ada riwayat WD.</div>`; return; }
        snap.forEach(docu=>{
          const wd = docu.data();
          const created = wd.createdAt?.toDate?.().toLocaleString("id-ID") || "-";
          const item = document.createElement("div");
          item.className="item";
          const left = document.createElement("div");
          left.innerHTML = `<div><b>${wd.walletType}</b> ¬∑ ${wd.walletNumber}</div>
                            <div class="muted">Rp ${wd.amount.toLocaleString("id-ID")} ¬∑ ${created}</div>`;
          const right = document.createElement("div");
          right.className="status "+(wd.status==="success"?"s-success":(wd.status==="pending"?"s-pending":"s-failed"));
          right.textContent = wd.status;
          item.appendChild(left); item.appendChild(right);
          list.appendChild(item);
        });
      });
    }

  </script>

</body>
</html>
