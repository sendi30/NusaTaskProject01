<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Money Web App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: var(--bg);
      color: var(--text);
      transition: 0.3s;
    }
    :root {
      --bg: #f4f4f4;
      --text: #222;
      --card: #fff;
      --primary: #4CAF50;
    }
    .dark {
      --bg: #1e1e1e;
      --text: #f4f4f4;
      --card: #2a2a2a;
      --primary: #00c853;
    }
    .container { padding: 15px; max-width: 450px; margin: auto; }
    .card { background: var(--card); border-radius: 12px; padding: 15px; margin: 10px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
    h2 { margin-top: 0; font-size: 20px; }
    input, select, button {
      width: 100%; padding: 10px; margin: 8px 0;
      border-radius: 8px; border: 1px solid #ccc; font-size: 14px;
    }
    button { background: var(--primary); color: white; border: none; cursor: pointer; }
    button:disabled { background: gray; cursor: not-allowed; }
    .topbar { display: flex; justify-content: space-between; align-items: center; }
    .saldo { font-size: 14px; font-weight: bold; }
    .riwayat-item { padding: 8px; border-bottom: 1px solid #ccc; font-size: 14px; }
    .banner { background: #ddd; height: 60px; margin: 5px 0; text-align: center; line-height: 60px; border-radius: 8px; }
    .theme-toggle { float: right; cursor: pointer; font-size: 12px; }
  </style>
</head>
<body>
<div class="container">

  <!-- Login/Register -->
  <div id="authCard" class="card">
    <h2>Login / Registrasi</h2>
    <div class="banner">[Iklan Banner 1]</div>
    <div class="banner">[Iklan Banner 2]</div>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="register()">Registrasi</button>
    <button onclick="login()">Login</button>
    <div class="banner">[Iklan Banner 3]</div>
    <div class="banner">[Iklan Banner 4]</div>
  </div>

  <!-- Halaman Utama -->
  <div id="mainCard" class="card" style="display:none;">
    <div class="topbar">
      <div>
        <img id="profilePic" src="https://via.placeholder.com/40" style="border-radius:50%;">
        <span id="username"></span>
      </div>
      <div class="saldo">Saldo: Rp <span id="saldo">0</span></div>
    </div>
    <div class="theme-toggle" onclick="toggleTheme()">ðŸŒ“ Tema</div>

    <button id="btnIklan" onclick="klikIklan()">Klik Iklan (Reward Rp10)</button>
    <p id="cooldownIklan"></p>

    <button id="btnHiltoads" onclick="showHiltoads()">Tugas Hiltoads (Reward Rp10)</button>
    <p id="cooldownHiltoads"></p>

    <!-- Halaman Hiltoads -->
    <div id="hiltoadsPage" style="display:none;">
      <div class="banner">[Hiltoads Banner 1]</div>
      <div class="banner">[Hiltoads Banner 2]</div>
      <div class="banner">[Hiltoads Banner 3]</div>
      <div class="banner">[Hiltoads Banner 4]</div>
      <div class="banner">[Hiltoads Banner 5]</div>
      <button id="exitHiltoads" disabled onclick="exitHiltoads()">Keluar</button>
    </div>

    <!-- Withdraw -->
    <h3>Withdraw</h3>
    <select id="method">
      <option value="Dana">Dana</option>
      <option value="OVO">OVO</option>
      <option value="Gopay">Gopay</option>
      <option value="ShopeePay">ShopeePay</option>
    </select>
    <input type="text" id="nomor" placeholder="Nomor E-Wallet">
    <input type="number" id="jumlah" placeholder="Jumlah WD (min Rp30.000)">
    <button onclick="ajukanWD()">Ajukan WD</button>

    <h3>Riwayat WD</h3>
    <div id="riwayatWD"></div>

    <button onclick="logout()">Logout</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
    authDomain: "penyimpanansaldo-280df.firebaseapp.com",
    projectId: "penyimpanansaldo-280df",
    storageBucket: "penyimpanansaldo-280df.appspot.com",
    messagingSenderId: "659609775130",
    appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
    measurementId: "G-L4TW7E23H2"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ---------------- Auth ----------------
  function register(){
    const email = emailEl.value, pass = passwordEl.value;
    auth.createUserWithEmailAndPassword(email,pass)
      .then(()=>alert("Registrasi berhasil"))
      .catch(e=>alert(e.message));
  }
  function login(){
    const email = emailEl.value, pass = passwordEl.value;
    auth.signInWithEmailAndPassword(email,pass)
      .then(()=>{})
      .catch(e=>alert(e.message));
  }
  function logout(){ auth.signOut(); }

  auth.onAuthStateChanged(async user=>{
    if(user){
      document.getElementById("authCard").style.display="none";
      document.getElementById("mainCard").style.display="block";
      document.getElementById("username").innerText=user.email;
      await loadSaldo();
      loadRiwayatWD();
    } else {
      document.getElementById("authCard").style.display="block";
      document.getElementById("mainCard").style.display="none";
    }
  });

  // ---------------- Saldo ----------------
  async function loadSaldo(){
    const uid = auth.currentUser.uid;
    const ref = db.collection("users").doc(uid);
    const snap = await ref.get();
    if(!snap.exists){ await ref.set({saldo:0, lastClick:0, clicksToday:0, lastReset:new Date()}); }
    document.getElementById("saldo").innerText=(snap.data().saldo||0);
  }
  async function updateSaldo(amount){
    const uid=auth.currentUser.uid;
    const ref=db.collection("users").doc(uid);
    await db.runTransaction(async t=>{
      const d=await t.get(ref);
      let saldo=d.data().saldo||0;
      saldo+=amount;
      t.update(ref,{saldo});
    });
    loadSaldo();
  }

  // ---------------- Anti Tuyul Cooldown ----------------
  async function klikIklan(){
    const uid=auth.currentUser.uid, ref=db.collection("users").doc(uid);
    await db.runTransaction(async t=>{
      const d=await t.get(ref);
      let data=d.data();
      let now=Date.now();
      let lastReset=new Date(data.lastReset||0);
      if(new Date().getHours()>=3 && lastReset.getDate()!=new Date().getDate()){
        data.clicksToday=0; data.lastReset=new Date();
      }
      if(data.clicksToday>=20){ alert("Limit harian tercapai"); return; }
      if(now-data.lastClick<5000){ alert("Cooldown 5 detik"); return; }
      data.clicksToday++;
      data.lastClick=now;
      data.saldo=(data.saldo||0)+10;
      t.set(ref,data);
    });
    loadSaldo();
  }

  let hiltoadsCooldown=0;
  function showHiltoads(){
    let now=Date.now();
    if(now<hiltoadsCooldown){ alert("Tunggu cooldown 10 menit"); return; }
    document.getElementById("hiltoadsPage").style.display="block";
    const btn=document.getElementById("exitHiltoads");
    btn.disabled=true;
    setTimeout(()=>{ btn.disabled=false; },5000);
  }
  function exitHiltoads(){
    document.getElementById("hiltoadsPage").style.display="none";
    updateSaldo(10);
    hiltoadsCooldown=Date.now()+600000;
  }

  // ---------------- WD ----------------
  async function ajukanWD(){
    const uid=auth.currentUser.uid;
    const email=auth.currentUser.email;
    const method=document.getElementById("method").value;
    const nomor=document.getElementById("nomor").value;
    const jumlah=parseInt(document.getElementById("jumlah").value);
    if(jumlah<30000){ alert("Minimal WD Rp30.000"); return; }
    await db.collection("withdrawals").add({
      userId:uid, email, method, nomor, jumlah,
      status:"Pending", createdAt:new Date()
    });
    alert("WD berhasil diajukan!");
    loadRiwayatWD();
    // Kirim ke Telegram
    const token="1.8236562243:AAFIyLCk2fu9-4GxxYSuIoSKw9DEiv1DVko";
    const chatId="8322802091";
    const msg=`ðŸ“¢ WD Baru\nðŸ‘¤ ${email}\nðŸ’³ ${method}\nðŸ“± ${nomor}\nðŸ’° Rp${jumlah}\nðŸ•’ ${new Date().toLocaleString()}`;
    fetch(`https://api.telegram.org/bot${token}/sendMessage`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({chat_id:chatId,text:msg})
    });
  }
  async function loadRiwayatWD(){
    const uid=auth.currentUser.uid;
    const q=await db.collection("withdrawals").where("userId","==",uid).orderBy("createdAt","desc").get();
    let html="";
    q.forEach(doc=>{
      const d=doc.data();
      html+=`<div class="riwayat-item">
        ðŸ’³ ${d.method} - ${d.nomor}<br>
        ðŸ’° Rp${d.jumlah}<br>
        ðŸ“… ${d.createdAt.toDate().toLocaleString()}<br>
        Status: <b>${d.status}</b>
      </div>`;
    });
    document.getElementById("riwayatWD").innerHTML=html||"Belum ada riwayat WD";
  }

  // ---------------- Tema ----------------
  function toggleTheme(){ document.body.classList.toggle("dark"); }
</script>
</body>
</html>
