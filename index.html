<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Money Web App</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; color:#333; }
    .dark { background:#121212; color:#fff; }
    .container { max-width:500px; margin:0 auto; padding:20px; }
    .card { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .dark .card { background:#1e1e1e; }
    .btn { display:block; width:100%; padding:15px; border:none; border-radius:8px; font-size:16px; margin:10px 0; cursor:pointer; }
    .btn-primary { background:#007bff; color:#fff; }
    .btn-danger { background:#dc3545; color:#fff; }
    .btn-disabled { background:#aaa; color:#fff; cursor:not-allowed; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .notif { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#333; color:#fff; padding:10px 20px; border-radius:8px; display:none; }
    .dark .notif { background:#eee; color:#000; }
  </style>
</head>
<body>
  <div class="container">
    <div id="auth-card" class="card">
      <h2>Login / Register</h2>
      <input type="email" id="email" placeholder="Email" class="btn">
      <input type="password" id="password" placeholder="Password" class="btn">
      <button class="btn btn-primary" onclick="login()">Login</button>
      <button class="btn" onclick="register()">Register</button>
    </div>

    <div id="main-card" class="card" style="display:none;">
      <div class="top-bar">
        <div><b id="user-name"></b></div>
        <div>Saldo: Rp <span id="saldo">0</span></div>
      </div>
      <button id="monetagBtn" class="btn btn-primary">Klik Iklan Monetag +Rp30.000</button>
      <button id="hiltoadsBtn" class="btn btn-primary">Lihat Iklan Hiltoads +Rp30.000</button>
      <button onclick="withdraw()" class="btn btn-danger">Withdraw</button>
      <button onclick="toggleTheme()" class="btn">ðŸŒ— Ganti Tema</button>
      <button onclick="logout()" class="btn">Logout</button>
    </div>
  </div>

  <div id="notif" class="notif"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
      authDomain: "penyimpanansaldo-280df.firebaseapp.com",
      databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "penyimpanansaldo-280df",
      storageBucket: "penyimpanansaldo-280df.firebasestorage.app",
      messagingSenderId: "659609775130",
      appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
      measurementId: "G-L4TW7E23H2"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;

    function notif(msg){
      let n=document.getElementById("notif");
      n.innerText=msg;
      n.style.display="block";
      setTimeout(()=>{n.style.display="none"},3000);
    }

    function register(){
      let email=document.getElementById("email").value;
      let pass=document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email,pass)
      .then(cred=>{
        db.ref("users/"+cred.user.uid).set({
          email:email, saldo:0, lastMonetag:0, lastHiltoads:0, dailyMonetag:0
        });
        notif("Registrasi berhasil!");
      }).catch(e=>notif(e.message));
    }

    function login(){
      let email=document.getElementById("email").value;
      let pass=document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email,pass).catch(e=>notif(e.message));
    }

    function logout(){ auth.signOut(); }

    auth.onAuthStateChanged(user=>{
      if(user){
        currentUser=user;
        document.getElementById("auth-card").style.display="none";
        document.getElementById("main-card").style.display="block";
        document.getElementById("user-name").innerText=user.email;
        db.ref("users/"+user.uid+"/saldo").on("value",snap=>{
          document.getElementById("saldo").innerText=snap.val()||0;
        });
      }else{
        currentUser=null;
        document.getElementById("auth-card").style.display="block";
        document.getElementById("main-card").style.display="none";
      }
    });

    // Reward Monetag
    document.getElementById("monetagBtn").onclick=()=>{
      if(!currentUser) return;
      let ref=db.ref("users/"+currentUser.uid);
      ref.once("value").then(snap=>{
        let d=snap.val()||{}, now=Date.now(), last=d.lastMonetag||0, count=d.dailyMonetag||0;
        let today=new Date(); today.setHours(3,0,0,0);
        if(!d.resetDate||d.resetDate<today.getTime()){ count=0; ref.update({resetDate:today.getTime(),dailyMonetag:0}); }
        if(now-last<5000){ notif("Cooldown 5 detik!"); return; }
        if(count>=20){ notif("Limit 20x per hari!"); return; }
        ref.child("saldo").transaction(s=> (s||0)+30000);
        ref.update({lastMonetag:now,dailyMonetag:count+1});
        notif("+Rp30.000 Monetag!");
      });
    };

    // Reward Hiltoads
    document.getElementById("hiltoadsBtn").onclick=()=>{
      if(!currentUser) return;
      let ref=db.ref("users/"+currentUser.uid);
      ref.once("value").then(snap=>{
        let d=snap.val()||{}, now=Date.now(), last=d.lastHiltoads||0;
        if(now-last<600000){ notif("Cooldown 10 menit!"); return; }
        ref.child("saldo").transaction(s=>(s||0)+30000);
        ref.update({lastHiltoads:now});
        notif("+Rp30.000 Hiltoads!");
      });
    };

    function withdraw(){
      if(!currentUser) return;
      let ref=db.ref("users/"+currentUser.uid);
      ref.once("value").then(snap=>{
        let d=snap.val()||{}, saldo=d.saldo||0;
        if(saldo<30000){ notif("Minimal WD Rp30.000!"); return; }
        let wdRef=db.ref("withdraws").push();
        wdRef.set({uid:currentUser.uid,email:currentUser.email,amount:saldo,status:"Pending"});
        notif("WD Rp"+saldo+" diajukan!");
      });
    }

    function toggleTheme(){
      document.body.classList.toggle("dark");
    }
  </script>
</body>
</html>
