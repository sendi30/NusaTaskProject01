<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NUSATASK — Admin Panel</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#07101a;--bg2:#06111a;
    --card:rgba(255,255,255,0.03);
    --muted:#98a0ad;
    --accent:#7c5cff;
    --accent-2:#44d7b6;
    --danger:#ff4d6d;--success:#22c55e;
    --glass-border:rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#e8f0ff}
  .shell{max-width:900px;margin:40px auto;padding:20px;background:rgba(255,255,255,0.02);border:1px solid var(--glass-border);border-radius:16px;box-shadow:0 8px 40px rgba(0,0,0,.4)}
  h1{margin-top:0;font-size:22px}
  .btn{padding:6px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:600}
  .btn.ban{background:var(--danger);color:white}
  .btn.unban{background:var(--success);color:white}
  .btn.update{background:var(--accent);color:white}
  table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.05);text-align:left}
  th{color:var(--muted)}
  .muted{color:var(--muted)}
  input{padding:6px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:white}
</style>
</head>
<body>
<div class="shell" id="loginCard">
  <h1>Login Admin</h1>
  <label>Email</label><br/>
  <input id="adminEmail" type="email" placeholder="admin email"/><br/><br/>
  <label>Password</label><br/>
  <input id="adminPass" type="password" placeholder="password"/><br/><br/>
  <button id="btnAdminLogin" class="btn update">Login</button>
  <p class="muted" style="margin-top:10px">Hanya email & password admin yang valid.</p>
</div>

<div class="shell" id="adminPanel" style="display:none">
  <h1>Admin Dashboard — NUSATASK</h1>
  <div style="margin-bottom:16px">
    <label>Limit Harian: </label>
    <input id="dailyLimitIn" type="number" style="width:80px"/>
    <button id="btnUpdateLimit" class="btn update">Update</button>
  </div>
  <table id="userTable">
    <thead>
      <tr>
        <th>Email</th><th>Saldo</th><th>Status</th><th>ActionsToday</th><th>Device</th><th>IP</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getDatabase, ref, get, update, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

/* Config */
const firebaseConfig={apiKey:"AIzaSyAUcac_uXdofDbqPwltgb4m7qIPiQhJi0s",authDomain:"nusataskproject.firebaseapp.com",databaseURL:"https://nusataskproject-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"nusataskproject",storageBucket:"nusataskproject.firebasestorage.app",messagingSenderId:"409602188456",appId:"1:409602188456:web:6302d3030b763324e28e9d",measurementId:"G-9389QL1WRE"};
const app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getDatabase(app);

/* Elements */
const loginCard=document.getElementById('loginCard');
const adminPanel=document.getElementById('adminPanel');
const btnLogin=document.getElementById('btnAdminLogin');
const emailIn=document.getElementById('adminEmail');
const passIn=document.getElementById('adminPass');
const userTable=document.querySelector('#userTable tbody');
const dailyLimitIn=document.getElementById('dailyLimitIn');
const btnUpdateLimit=document.getElementById('btnUpdateLimit');

/* Login */
btnLogin.onclick=()=>{signInWithEmailAndPassword(auth,emailIn.value,passIn.value).catch(e=>alert(e.message));};

/* Auth state */
onAuthStateChanged(auth,async user=>{
  if(user){
    if(user.email!=="admin111@gmail.com"){alert("Bukan admin!");return;}
    loginCard.style.display='none';adminPanel.style.display='block';
    loadUsers();
    loadConfig();
  }
});

/* Load users */
function loadUsers(){
  onValue(ref(db,'users'),snap=>{
    userTable.innerHTML='';
    snap.forEach(c=>{
      const u=c.val();const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${u.email||'-'}</td>
        <td>Rp ${(u.balance||0).toLocaleString('id-ID')}</td>
        <td>${u.status||'-'}</td>
        <td>${u.actionsToday||0}</td>
        <td>${u.deviceId||'-'}</td>
        <td>${u.lastIp||'-'}</td>
        <td>
          <button class="btn ban" onclick="banUser('${c.key}')">Ban</button>
          <button class="btn unban" onclick="unbanUser('${c.key}')">Unban</button>
        </td>`;
      userTable.appendChild(tr);
    });
  });
}

/* Config */
function loadConfig(){
  onValue(ref(db,'config/dailyLimit'),snap=>{
    if(snap.exists())dailyLimitIn.value=snap.val();
  });
}
btnUpdateLimit.onclick=()=>{const v=Number(dailyLimitIn.value)||30;set(ref(db,'config/dailyLimit'),v);alert("Limit harian diupdate!");};

/* Ban/Unban */
window.banUser=(uid)=>{update(ref(db,'users/'+uid),{status:'banned'});};
window.unbanUser=(uid)=>{update(ref(db,'users/'+uid),{status:'active'});};
</script>
</body>
</html>