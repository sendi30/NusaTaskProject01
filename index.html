<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Web Penghasil Uang</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .banner { width:100%; height:80px; background:#ddd; margin:10px 0; text-align:center; line-height:80px; }
    .button { padding:10px 20px; margin:10px; cursor:pointer; border:none; border-radius:8px; background:#4CAF50; color:white; }
    #main { margin-top:20px; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .profile { display:flex; align-items:center; }
    .profile img { width:40px; height:40px; border-radius:50%; margin-right:10px; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>

<div id="auth-section">
  <div class="banner">[Iklan Hiltoads Banner 1]</div>
  <div class="banner">[Iklan Hiltoads Banner 2]</div>

  <h2>Login / Registrasi</h2>
  <input id="email" type="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button id="loginBtn" class="button">Login</button>
  <button id="registerBtn" class="button">Register</button>

  <div class="banner">[Iklan Hiltoads Banner 3]</div>
  <div class="banner">[Iklan Hiltoads Banner 4]</div>
</div>

<div id="main" class="hidden">
  <div class="top-bar">
    <div class="profile">
      <img src="https://via.placeholder.com/40" id="profilePic">
      <span id="username"></span>
    </div>
    <div>Saldo: Rp <span id="saldo">0</span></div>
  </div>

  <button id="monetagBtn" class="button">Klik Iklan Monetag (Reward Rp10)</button>
  <br>
  <button id="hiltoadsBtn" class="button">Tugas Hiltoads (Reward Rp10)</button>

  <div id="hiltoadsPage" class="hidden">
    <h3>Iklan Hiltoads</h3>
    <div class="banner">[Iklan Hiltoads 1]</div>
    <div class="banner">[Iklan Hiltoads 2]</div>
    <div class="banner">[Iklan Hiltoads 3]</div>
    <div class="banner">[Iklan Hiltoads 4]</div>
    <div class="banner">[Iklan Hiltoads 5]</div>
    <button id="closeHiltoads" class="button hidden">Tutup Halaman</button>
  </div>

  <br><br>
  <button id="helpBtn" class="button">Help</button>
  <button id="withdrawBtn" class="button">Withdraw</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
    authDomain: "penyimpanansaldo-280df.firebaseapp.com",
    databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "penyimpanansaldo-280df",
    storageBucket: "penyimpanansaldo-280df.firebasestorage.app",
    messagingSenderId: "659609775130",
    appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
    measurementId: "G-L4TW7E23H2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Elemen
  const authSection = document.getElementById('auth-section');
  const main = document.getElementById('main');
  const saldoEl = document.getElementById('saldo');
  const usernameEl = document.getElementById('username');
  const monetagBtn = document.getElementById('monetagBtn');
  const hiltoadsBtn = document.getElementById('hiltoadsBtn');
  const hiltoadsPage = document.getElementById('hiltoadsPage');
  const closeHiltoads = document.getElementById('closeHiltoads');
  const helpBtn = document.getElementById('helpBtn');
  const withdrawBtn = document.getElementById('withdrawBtn');

  async function register(email, password) {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    await setDoc(doc(db, "users", user.uid), {
      email: user.email,
      saldo: 0,
      todayClicks: 0,
      lastClick: null,
      lastHiltoads: null
    });
  }

  async function login(email, password) {
    await signInWithEmailAndPassword(auth, email, password);
  }

  // Login & Register
  document.getElementById("loginBtn").onclick = () => {
    login(document.getElementById("email").value, document.getElementById("password").value);
  };
  document.getElementById("registerBtn").onclick = () => {
    register(document.getElementById("email").value, document.getElementById("password").value);
  };

  // Reset harian jam 03.00
  function isResetNeeded(lastClick) {
    if (!lastClick) return true;
    const now = new Date();
    const last = lastClick.toDate ? lastClick.toDate() : new Date(lastClick);
    const resetTime = new Date(now);
    resetTime.setHours(3,0,0,0);
    if (now > resetTime && last < resetTime) return true;
    return false;
  }

  async function updateUI(user) {
    const userRef = doc(db, "users", user.uid);
    const snap = await getDoc(userRef);
    if (snap.exists()) {
      let data = snap.data();
      if (isResetNeeded(data.lastClick)) {
        await updateDoc(userRef, { todayClicks: 0 });
        data.todayClicks = 0;
      }
      saldoEl.textContent = data.saldo;
      usernameEl.textContent = data.email;
    }
  }

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      authSection.classList.add("hidden");
      main.classList.remove("hidden");
      updateUI(user);
    } else {
      authSection.classList.remove("hidden");
      main.classList.add("hidden");
    }
  });

  // Monetag Button
  monetagBtn.onclick = async () => {
    const user = auth.currentUser;
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      let data = snap.data();
      const now = new Date();
      if (data.lastClick && now - data.lastClick.toDate() < 5000) {
        alert("Cooldown 5 detik!");
        return;
      }
      if (data.todayClicks >= 20) {
        alert("Sudah 20 kali hari ini!");
        return;
      }
      await updateDoc(ref, {
        saldo: data.saldo + 10,
        todayClicks: data.todayClicks + 1,
        lastClick: serverTimestamp()
      });
      alert("Berhasil +Rp10");
      updateUI(user);
    }
  };

  // Hiltoads Button
  hiltoadsBtn.onclick = async () => {
    hiltoadsPage.classList.remove("hidden");
    closeHiltoads.classList.add("hidden");
    setTimeout(() => { closeHiltoads.classList.remove("hidden"); }, 5000);
  };
  closeHiltoads.onclick = async () => {
    const user = auth.currentUser;
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      let data = snap.data();
      const now = new Date();
      if (data.lastHiltoads && now - data.lastHiltoads.toDate() < 10*60*1000) {
        alert("Cooldown 10 menit!");
        return;
      }
      await updateDoc(ref, {
        saldo: data.saldo + 10,
        lastHiltoads: serverTimestamp()
      });
      alert("Reward Hiltoads +Rp10");
      hiltoadsPage.classList.add("hidden");
      updateUI(user);
    }
  };

  // Help button
  helpBtn.onclick = () => {
    window.location.href = "https://t.me/YourTelegramUsername"; // ganti username telegram kamu
  };

  // Withdraw
  withdrawBtn.onclick = async () => {
    const metode = prompt("Metode E-Wallet (Dana/OVO/Gopay/ShopeePay):");
    const nomor = prompt("Nomor E-Wallet:");
    const jumlah = parseInt(prompt("Jumlah WD (min Rp30.000):"));
    const user = auth.currentUser;
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      let data = snap.data();
      if (jumlah < 30000) {
        alert("Minimal WD Rp30.000");
        return;
      }
      if (data.saldo < jumlah) {
        alert("Saldo tidak cukup");
        return;
      }
      await addDoc(collection(db, "withdraws"), {
        uid: user.uid,
        email: data.email,
        metode,
        nomor,
        jumlah,
        status: "pending",
        createdAt: serverTimestamp()
      });
      await updateDoc(ref, { saldo: data.saldo - jumlah });
      alert("WD berhasil diajukan!");
      updateUI(user);
    }
  };
</script>

</body>
</html>
