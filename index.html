<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Penghasil Uang</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; color:#222; }
    header { display:flex; justify-content:space-between; align-items:center; padding:10px; background:#6200ea; color:#fff; }
    header img { width:40px; height:40px; border-radius:50%; }
    header .saldo { font-size:14px; font-weight:bold; }
    main { padding:15px; }
    .card { background:#fff; margin:10px 0; padding:15px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    button { width:100%; padding:12px; margin-top:10px; border:none; border-radius:8px; font-size:16px; cursor:pointer; background:#6200ea; color:#fff; }
    button:disabled { background:#aaa; cursor:not-allowed; }
    .hidden { display:none; }
    .ads { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:10px 0; }
    .ads img { width:100%; border-radius:8px; }
    .toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#333; color:#fff; padding:10px 20px; border-radius:8px; display:none; }
    .dark { background:#121212; color:#eee; }
    .dark header { background:#333; }
    .link { color:#6200ea; text-decoration:underline; cursor:pointer; font-size:14px; }
  </style>
</head>
<body>
  <header id="appHeader" class="hidden">
    <div id="profileSection">
      <img id="profilePic" src="https://via.placeholder.com/40">
      <span id="userName"></span>
    </div>
    <div class="saldo">Saldo: Rp <span id="saldo">0</span></div>
  </header>

  <main>
    <!-- Login / Register -->
    <section id="authSection">
      <div class="ads">
        <img src="https://via.placeholder.com/150x80?text=Hiltoads+Ad">
        <img src="https://via.placeholder.com/150x80?text=Hiltoads+Ad">
      </div>
      <div class="card">
        <h2 id="authTitle">Login</h2>
        <input id="email" type="email" placeholder="Email" style="width:100%;padding:10px;margin:5px 0;">
        <input id="password" type="password" placeholder="Password" style="width:100%;padding:10px;margin:5px 0;">
        <button onclick="login()">Login</button>
        <p style="text-align:center;">Belum punya akun? <span class="link" onclick="toggleAuth()">Register</span></p>
      </div>
      <div class="ads">
        <img src="https://via.placeholder.com/150x80?text=Hiltoads+Ad">
        <img src="https://via.placeholder.com/150x80?text=Hiltoads+Ad">
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboardSection" class="hidden">
      <div class="card">
        <button id="monetagBtn" onclick="klikMonetag()">Klik Iklan Monetag (Reward Rp30.000)</button>
        <div id="monetagCountdown" style="text-align:center;font-size:14px;"></div>
      </div>
      <div class="card">
        <button id="hiltoadsBtn" onclick="showHiltoads()">Tugas Hiltoads (Reward Rp30.000)</button>
        <div id="hiltoadsCountdown" style="text-align:center;font-size:14px;"></div>
      </div>
      <div class="card">
        <button onclick="showWD()">Ajukan Withdraw</button>
        <button onclick="showRiwayat()" style="background:#0288d1;">Riwayat WD</button>
      </div>
      <div class="card">
        <button onclick="toggleTheme()" style="background:#444;">Tema Terang / Gelap</button>
      </div>
    </section>

    <!-- Halaman Hiltoads -->
    <section id="hiltoadsSection" class="hidden">
      <h3>Lihat Iklan Hiltoads</h3>
      <div class="ads" style="grid-template-columns:1fr;">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+1">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+2">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+3">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+4">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+5">
      </div>
      <button id="closeHiltoadsBtn" disabled onclick="selesaiHiltoads()">Kembali</button>
    </section>

    <!-- Withdraw -->
    <section id="wdSection" class="hidden">
      <h3>Ajukan Withdraw</h3>
      <input id="ewallet" placeholder="E-Wallet (Dana/OVO/GoPay/ShopeePay)" style="width:100%;padding:10px;margin:5px 0;">
      <input id="nominal" type="number" placeholder="Jumlah (min 30000)" style="width:100%;padding:10px;margin:5px 0;">
      <button onclick="ajukanWD()">Kirim</button>
      <button onclick="backDashboard()">Kembali</button>
    </section>

    <!-- Riwayat WD -->
    <section id="riwayatSection" class="hidden">
      <h3>Riwayat Withdraw</h3>
      <div id="riwayatList"></div>
      <button onclick="backDashboard()">Kembali</button>
    </section>
  </main>

  <div class="toast" id="toast"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
    authDomain: "penyimpanansaldo-280df.firebaseapp.com",
    projectId: "penyimpanansaldo-280df",
    storageBucket: "penyimpanansaldo-280df.appspot.com",
    messagingSenderId: "659609775130",
    appId: "1:659609775130:web:bdd088ca5a877498c5b5a3"
  };
  firebase.initializeApp(firebaseConfig);
  const auth=firebase.auth(), db=firebase.firestore();

  let modeRegister=false, currentUser=null;
  let monetagTimer=null, hiltoadsTimer=null;

  const toast=msg=>{const t=document.getElementById("toast");t.innerText=msg;t.style.display="block";setTimeout(()=>t.style.display="none",3000);};

  function toggleAuth(){modeRegister=!modeRegister;document.getElementById("authTitle").innerText=modeRegister?"Register":"Login";document.querySelector("#authSection button").innerText=modeRegister?"Register":"Login";}
  function login(){const e=document.getElementById("email").value,p=document.getElementById("password").value;if(modeRegister){auth.createUserWithEmailAndPassword(e,p).then(()=>toast("Registrasi sukses")).catch(err=>toast(err.message));}else{auth.signInWithEmailAndPassword(e,p).catch(err=>toast(err.message));}}
  auth.onAuthStateChanged(u=>{if(u){currentUser=u;initUser(u.uid);document.getElementById("authSection").classList.add("hidden");document.getElementById("dashboardSection").classList.remove("hidden");document.getElementById("appHeader").classList.remove("hidden");document.getElementById("userName").innerText=u.email;}else{currentUser=null;document.getElementById("authSection").classList.remove("hidden");document.getElementById("dashboardSection").classList.add("hidden");document.getElementById("appHeader").classList.add("hidden");}});
  
  async function initUser(uid){
    const ref=db.collection("users").doc(uid);
    const snap=await ref.get();
    if(!snap.exists){await ref.set({saldo:0,monetagCount:0,monetagLast:0,hiltoadsLast:0});}
    ref.onSnapshot(s=>{document.getElementById("saldo").innerText=s.data().saldo;});
    loadRiwayat(uid);
    startCountdowns();
  }

  async function klikMonetag(){
    const uid=currentUser.uid,ref=db.collection("users").doc(uid);
    await db.runTransaction(async t=>{
      const d=(await t.get(ref)).data(),now=Date.now(),todayKey=new Date().toLocaleDateString("id-ID");
      if(d.monetagDayKey!==todayKey){d.monetagCount=0;d.monetagDayKey=todayKey;}
      if(d.monetagCount>=20) throw "Limit harian tercapai";
      if(now-d.monetagLast<5000) throw "Cooldown belum selesai";
      t.update(ref,{saldo:firebase.firestore.FieldValue.increment(30000),monetagCount:d.monetagCount+1,monetagLast:now,monetagDayKey:todayKey});
    }).then(()=>toast("Reward Rp30.000 masuk")).catch(e=>toast(e));
  }

  function showHiltoads(){document.getElementById("dashboardSection").classList.add("hidden");document.getElementById("hiltoadsSection").classList.remove("hidden");document.getElementById("closeHiltoadsBtn").disabled=true;setTimeout(()=>{document.getElementById("closeHiltoadsBtn").disabled=false;},5000);}
  async function selesaiHiltoads(){
    const uid=currentUser.uid,ref=db.collection("users").doc(uid);
    await db.runTransaction(async t=>{
      const d=(await t.get(ref)).data(),now=Date.now();
      if(now-d.hiltoadsLast<600000) throw "Cooldown 10 menit belum selesai";
      t.update(ref,{saldo:firebase.firestore.FieldValue.increment(30000),hiltoadsLast:now});
    }).then(()=>toast("Reward Rp30.000 masuk")).catch(e=>toast(e));
    backDashboard();
  }

  function showWD(){document.getElementById("dashboardSection").classList.add("hidden");document.getElementById("wdSection").classList.remove("hidden");}
  async function ajukanWD(){
    const ewallet=document.getElementById("ewallet").value,nominal=parseInt(document.getElementById("nominal").value);
    if(!ewallet||nominal<30000) return toast("Minimal WD Rp30.000 & isi e-wallet");
    const uid=currentUser.uid,ref=db.collection("users").doc(uid);
    await db.runTransaction(async t=>{
      const d=(await t.get(ref)).data();if(d.saldo<nominal) throw "Saldo tidak cukup";t.update(ref,{saldo:d.saldo-nominal});
    }).then(async()=>{await db.collection("withdraws").add({uid,ewallet,nominal,status:"Pending",time:firebase.firestore.FieldValue.serverTimestamp()});toast("WD diajukan");}).catch(e=>toast(e));
  }

  function showRiwayat(){document.getElementById("dashboardSection").classList.add("hidden");document.getElementById("riwayatSection").classList.remove("hidden");}
  function loadRiwayat(uid){db.collection("withdraws").where("uid","==",uid).orderBy("time","desc").onSnapshot(s=>{let html="";s.forEach(doc=>{const d=doc.data();html+=`<div class="card">Rp${d.nominal} - ${d.ewallet} [${d.status}]</div>`});document.getElementById("riwayatList").innerHTML=html||"<p>Belum ada riwayat WD</p>";});}

  function backDashboard(){document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));document.getElementById("dashboardSection").classList.remove("hidden");}
  function toggleTheme(){document.body.classList.toggle("dark");}

  // countdown realtime
  function startCountdowns(){
    if(monetagTimer) clearInterval(monetagTimer);
    if(hiltoadsTimer) clearInterval(hiltoadsTimer);
    monetagTimer=setInterval(async()=>{
      if(!currentUser) return;
      const d=(await db.collection("users").doc(currentUser.uid).get()).data();
      const now=Date.now();
      let remain=5000-(now-d.monetagLast);
      if(remain>0){document.getElementById("monetagCountdown").innerText=`Cooldown: ${Math.ceil(remain/1000)} dtk`;document.getElementById("monetagBtn").disabled=true;}else{document.getElementById("monetagCountdown").innerText="";document.getElementById("monetagBtn").disabled=false;}
      if(d.monetagCount>=20){document.getElementById("monetagCountdown").innerText="Limit harian 20x";document.getElementById("monetagBtn").disabled=true;}
    },1000);
    hiltoadsTimer=setInterval(async()=>{
      if(!currentUser) return;
      const d=(await db.collection("users").doc(currentUser.uid).get()).data();
      const now=Date.now();
      let remain=600000-(now-d.hiltoadsLast);
      if(remain>0){let m=Math.floor(remain/60000),s=Math.floor((remain%60000)/1000);document.getElementById("hiltoadsCountdown").innerText=`Cooldown: ${m}m ${s}d`;document.getElementById("hiltoadsBtn").disabled=true;}else{document.getElementById("hiltoadsCountdown").innerText="";document.getElementById("hiltoadsBtn").disabled=false;}
    },1000);
  }
</script>
</body>
</html>
